name: CI_minishell

on: push

jobs:
  msg:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: install thingz
        run: sudo apt install -y clang-tidy clang-format inkscape tcsh
      - name : make flags
        run: |
          curl https://img.shields.io/badge/test-passing-green -o good-flag.svg
          curl https://img.shields.io/badge/test-failed-red -o bad-flag.svg
          inkscape good-flag.svg --export-png=good-flag.png
          inkscape bad-flag.svg --export-png=bad-flag.png
      - name: get-wehook
        run : |
          web=`cat weblink`
          echo "hook=$web" >> $GITHUB_ENV
      - name: Ardorax Coding Style
        uses: Ardorax/EpitechStyle@latest
        id: coding_style
      - name: Compile_and_test
        run: |
          echo "color=16711680" >> $GITHUB_ENV
          mv bad-flag.png flag.png
          echo "DESCRIPTION=Build ERROR" >> $GITHUB_ENV
          eval "make re"
          makecode=$?
          ./mouliVD/script
          testcode=$?
          echo $testcode
          if (((makecode == 0) && (testcode == 0)))
          then
            echo "color=65280" >> $GITHUB_ENV
            rm flag.png
            mv good-flag.png flag.png
            echo "DESCRIPTION=SUCCES" >> $GITHUB_ENV
          fi
      - name: normi message
        if: always()
        uses: Ardorax/EpitechStyleDiscord@latest
        with:
          COLOR: ${{ env.color }}
          DESCRIPTION: ${{ env.DESCRIPTION }}
          SUMMARY: ${{ steps.coding_style.outputs.SUMMARY }}
          TRACE: trace.md
          USERNAME: Normeur
          URL: ${{env.hook}}
      - name: mouli message
        if: always()
        uses: Ardorax/EpitechStyleDiscord@latest
        with:
          COLOR: ${{ env.COLOR }}
          DESCRIPTION: "Your flag is"
          USERNAME: "Flag"
          URL: ${{ env.hook }}
          TRACE: flag.png
